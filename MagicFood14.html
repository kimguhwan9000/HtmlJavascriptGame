<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë§ˆë²• ìš”ë¦¬ì‚¬ - ì™„ë²½ ìŠ¤í° ì°¨ë‹¨ ì—ë””ì…˜</title>
    <style>
        body { margin: 0; background: #1c1c1c; color: #fff; font-family: 'Malgun Gothic', sans-serif; overflow: hidden; user-select: none; }
        
        /* [í•„ë“œ] ë“œë¡­ íƒ€ê²Ÿ ì„¤ì •: ì´ê³³ì— ì•„ì´í…œì„ ë“œë˜ê·¸í•˜ë©´ ë²„ë ¤ì§ */
        #field { position: absolute; width: 100%; height: 100%; background: radial-gradient(circle, #2c2c2c, #111); }

        /* [ìºë¦­í„°] ë§ˆë²•ì‚¬ ì…°í”„ */
        #chef { 
            position: absolute; bottom: 120px; left: 50%; transform: translateX(-50%); 
            width: 120px; height: 120px; cursor: pointer; transition: 0.3s; z-index: 5;
            display: flex; align-items: center; justify-content: center;
            animation: floating 3s ease-in-out infinite;
        }
        #chef img { width: 100%; height: auto; filter: drop-shadow(0 0 15px rgba(163, 102, 255, 0.6)); }

        @keyframes floating {
            0%, 100% { transform: translateX(-50%) translateY(0px); }
            50% { transform: translateX(-50%) translateY(-15px); }
        }

        /* [UI ë ˆì´ì•„ì›ƒ] */
        #inventory, #avatarUI { 
            position: absolute; top: 10px; width: 320px; max-height: 80vh; 
            background: rgba(17, 17, 17, 0.95); border: 2px solid #555; padding: 10px; border-radius: 10px; overflow-y: auto; z-index: 10; 
        }
        #inventory { left: 10px; }
        #avatarUI { right: 10px; display: flex; flex-direction: column; align-items: center; }

        #invList, #avatarSlots { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; }
        
        .invItem { 
            display: flex; flex-direction: column; align-items: center; background: #222; 
            border: 1px solid #444; border-radius: 8px; padding: 12px 5px; cursor: pointer; position: relative;
        }
        .invItem span:first-child { font-size: 45px; margin-bottom: 5px; }
        
        /* [ìˆ˜ëŸ‰ í‘œì‹œ] ì™¼ìª½ ìƒë‹¨ ë°°ì¹˜ */
        .itemBadge { position: absolute; top: 5px; left: 5px; background: #ff5722; color: white; font-size: 11px; font-weight: bold; padding: 2px 6px; border-radius: 10px; }
        
        /* [ì‚­ì œ ë²„íŠ¼] ì˜¤ë¥¸ìª½ ìƒë‹¨ ë°°ì¹˜ */
        .deleteBtn { 
            position: absolute; top: 5px; right: 5px; background: #444; color: #fff; 
            width: 18px; height: 18px; line-height: 16px; text-align: center; 
            border-radius: 50%; font-size: 12px; font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        .deleteBtn:hover { background: #ff4444; }

        /* [ìš”ë¦¬ UI] */
        #cookUI { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            width: 550px; display: none; z-index: 100; background: rgba(17, 17, 17, 0.95); 
            border: 3px solid #777; padding: 20px; border-radius: 10px; 
        }
        #timerDisplay { text-align: center; font-size: 24px; color: #ffeb3b; font-weight: bold; margin-bottom: 10px; }
        #slots { display: flex; gap: 10px; margin: 15px 0; justify-content: center; }
        .slot { width: 75px; height: 75px; border: 2px dashed #aaa; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 45px; cursor: pointer; }
        
        .bar { height: 28px; background: #222; position: relative; margin: 8px 0; border-radius: 14px; overflow: hidden; border: 2px solid #444; }
        .fill { height: 100%; width: 0%; transition: 0.1s; }
        .zone { position: absolute; top: 0; height: 100%; background: rgba(255, 255, 0, 0.2); border-left: 2px solid yellow; border-right: 2px solid yellow; }
        .successZone { background: rgba(0, 255, 0, 0.2); border-left: 2px solid #0f0; border-right: 2px solid #0f0; }
        
        button { padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        #fire { background: #ff5722; color: white; }
        #water { background: #03a9f4; color: white; }
        #start { background: #4caf50; color: white; width: 100%; margin-top: 15px; font-size: 18px; }

        .item { position: absolute; cursor: pointer; font-size: 38px; z-index: 2; transition: transform 0.2s; }
    </style>
</head>

<body>
    <div id="field" ondragover="event.preventDefault()" ondrop="dropToDelete(event)"></div>
    
    <div id="chef"><img src="./MagicFoodC01.png" alt="Chef"></div>

    <div id="inventory"><b>ğŸ’ ì¸ë²¤í† ë¦¬</b><div id="invList"></div></div>
    
    <div id="avatarUI"><b>ğŸ‘— ì œì‘ì•„ì´í…œ</b><div id="avatarSlots"></div><button id="resetData" style="width:100%; margin-top:20px; background:#444; color:#ccc; font-size:11px;">ì „ì²´ ì´ˆê¸°í™”</button></div>

    <div id="cookUI">
        <div style="display:flex; justify-content:space-between;"><b>ğŸ”® ë§ˆë²• ì—°ê¸ˆìˆ </b><span id="closeCook" style="cursor:pointer; color:red;">âœ–</span></div>
        <div id="timerDisplay">ì¤€ë¹„ ì¤‘...</div>
        <div style="text-align:center">ì¬ë£Œ 5ê°œë¥¼ ëª¨ìœ¼ì„¸ìš”! (<span id="cnt">0</span>/5)</div>
        <div id="slots"></div>
        <div class="bar"><div class="zone" style="left:35%;width:30%"></div><div class="fill" id="heatFill" style="background: linear-gradient(to right, #ffeb3b, #f44336);"></div></div>
        <div class="bar"><div class="zone successZone" style="left:60%;width:15%"></div><div class="fill" id="progFill" style="background:#00e676;"></div></div>
        <div style="display:flex; gap:10px;"><button id="fire" style="flex:1">ğŸ”¥ í™”ì—¼</button><button id="water" style="flex:1">â„ï¸ ëƒ‰ê¸°</button></div>
        <button id="start">âœ¨ ìš”ë¦¬ ì‹œì‘ (120ì´ˆ)</button>
    </div>

    <script>
        // ì˜¤ë””ì˜¤ ë° ê¸°ë³¸ ë³€ìˆ˜
        const fireSnd = new Audio("https://www.soundjay.com/magic/sounds/magic-chime-01.mp3");
        const waterSnd = new Audio("https://www.soundjay.com/magic/sounds/magic-chime-03.mp3");
        const successSnd = new Audio("https://codeskulptor-demos.commondatastorage.googleapis.com/puffer_fish/bubble.mp3");
        const failSnd = new Audio("https://codeskulptor-demos.commondatastorage.googleapis.com/GalaxyInvaders/pause.wav");

        let inventory = [], cookItems = [], equipped = [];
        let cooking = false, heat = 0, progress = 0, timer = null;
        let timeLeft = 120;

        /** [ì—…ë°ì´íŠ¸] ì§€ëŠ¥í˜• ì•„ì´í…œ ë¦¬ìŠ¤í° ë¡œì§ 
         * - ì¸ë²¤í† ë¦¬, ì œì‘ì°½ë¿ë§Œ ì•„ë‹ˆë¼ ì…°í”„(chef) ë’¤ì—ë„ ìŠ¤í°ë˜ì§€ ì•Šë„ë¡ ì¢Œí‘œ ì²´í¬
         */
        function spawnItem() {
            if (cooking || document.querySelectorAll('.item').length > 20) return; // ìµœëŒ€ ê°œìˆ˜ 20ê°œë¡œ ìƒí–¥

            const basic = [{ name: "ì•Œ", icon: "ğŸ¥š" }, { name: "ê°œêµ¬ë¦¬", icon: "ğŸ¸" }, { name: "ì•½ì´ˆ", icon: "ğŸŒ¿" }];
            const it = basic[Math.floor(Math.random() * basic.length)];
            
            let x, y, isSafe = false;
            let safetyCounter = 0; // ë¬´í•œë£¨í”„ ë°©ì§€ìš©

            while (!isSafe && safetyCounter < 50) {
                safetyCounter++;
                x = Math.random() * 90 + 5; // ì¢Œìš° 5% ì—¬ë°±
                y = Math.random() * 85 + 5; // ìƒí•˜ ì—¬ë°±

                // 1. ì™¼ìª½ ì¸ë²¤í† ë¦¬ ì˜ì—­ ì²´í¬
                const isInLeftUI = (x < 35 && y < 85);
                // 2. ì˜¤ë¥¸ìª½ ì œì‘ì•„ì´í…œ ì˜ì—­ ì²´í¬
                const isInRightUI = (x > 65 && y < 85);
                // 3. ì¤‘ì•™ í•˜ë‹¨ ì…°í”„ ì˜ì—­ ì²´í¬ (x: 40~60%, y: 65% ì´ìƒ)
                const isInChefUI = (x > 40 && x < 60 && y > 65);

                if (!isInLeftUI && !isInRightUI && !isInChefUI) {
                    isSafe = true;
                }
            }

            const d = document.createElement("div");
            d.className = "item"; d.innerText = it.icon; d.style.left = x + "%"; d.style.top = y + "%";
            d.onclick = () => { inventory.push(it); d.remove(); updateInv(); saveData(); };
            document.getElementById("field").appendChild(d);
        }
        setInterval(spawnItem, 1300); // ìŠ¤í° ì†ë„ 1.3ì´ˆë¡œ ì•½ê°„ ìƒí–¥

        /** ì¸ë²¤í† ë¦¬ UI ì—…ë°ì´íŠ¸ (Xë²„íŠ¼ ë° ë“œë˜ê·¸ í¬í•¨) */
        function updateInv() {
            const invList = document.getElementById("invList");
            invList.innerHTML = "";
            const summary = {};
            inventory.forEach(item => {
                if(!summary[item.name]) summary[item.name] = { ...item, count: 0 };
                summary[item.name].count++;
            });

            Object.values(summary).forEach(item => {
                const d = document.createElement("div");
                d.className = "invItem";
                d.draggable = true; 
                d.ondragstart = (e) => { e.dataTransfer.setData("name", item.name); };
                
                d.innerHTML = `
                    <span>${item.icon}</span>
                    <span>${item.name}</span>
                    ${item.count > 1 ? `<div class="itemBadge">x${item.count}</div>` : ""}
                    <div class="deleteBtn" title="ë²„ë¦¬ê¸°">Ã—</div>
                `;

                d.onclick = (e) => {
                    if(e.target.className === "deleteBtn") {
                        removeItem(item.name);
                    } else {
                        addSlot(item.name);
                    }
                };
                invList.appendChild(d);
            });
        }

        // ë“œë˜ê·¸í•´ì„œ í•„ë“œì— ë†“ì•˜ì„ ë•Œ ì‚­ì œ
        function dropToDelete(e) {
            e.preventDefault();
            const name = e.dataTransfer.getData("name");
            if (name) { removeItem(name); waterSnd.play(); }
        }

        // ì•„ì´í…œ 1ê°œ ì‚­ì œ ë¡œì§
        function removeItem(name) {
            const idx = inventory.findIndex(it => it.name === name);
            if (idx > -1) { inventory.splice(idx, 1); updateInv(); saveData(); }
        }

        // ìš”ë¦¬ ìŠ¬ë¡¯ ê´€ë¦¬
        function addSlot(itemName) {
            if (cooking || cookItems.length >= 5) return;
            const idx = inventory.findIndex(it => it.name === itemName);
            if (idx > -1) {
                cookItems.push(inventory[idx]);
                inventory.splice(idx, 1);
                updateInv(); updateSlots();
            }
        }

        function updateSlots() {
            const slotsDiv = document.getElementById("slots");
            slotsDiv.innerHTML = "";
            for (let i = 0; i < 5; i++) {
                const s = document.createElement("div");
                s.className = "slot";
                if (cookItems[i]) s.innerText = cookItems[i].icon;
                s.onclick = () => {
                    if (cooking || !cookItems[i]) return;
                    inventory.push(cookItems[i]); cookItems.splice(i, 1);
                    updateInv(); updateSlots();
                };
                slotsDiv.appendChild(s);
            }
            document.getElementById("cnt").innerText = cookItems.length;
        }

        // ì—°ê¸ˆìˆ  ì‹¤í–‰ ë¡œì§
        document.getElementById("chef").onclick = () => { if(!cooking) document.getElementById("cookUI").style.display = "block"; };
        document.getElementById("closeCook").onclick = () => {
            if(cooking) return;
            document.getElementById("cookUI").style.display = "none";
            cookItems.forEach(it => inventory.push(it));
            cookItems = []; updateInv(); updateSlots();
        };

        document.getElementById("fire").onclick = () => { if(cooking) { heat = Math.min(100, heat + 8); fireSnd.currentTime=0; fireSnd.play(); updateBars(); } };
        document.getElementById("water").onclick = () => { if(cooking) { heat = Math.max(0, heat - 10); waterSnd.currentTime=0; waterSnd.play(); updateBars(); } };

        document.getElementById("start").onclick = () => {
            if (cookItems.length < 5 || cooking) return;
            cooking = true; heat = 0; progress = 0; timeLeft = 120;
            timer = setInterval(() => {
                timeLeft--;
                document.getElementById("timerDisplay").innerText = `ë‚¨ì€ ì‹œê°„: ${timeLeft}ì´ˆ`;
                heat = Math.min(100, heat + 2.5);
                if (heat >= 35 && heat <= 65) progress += 1.5;
                else progress = Math.max(0, progress - 1);
                if (progress >= 60 && progress <= 75) finish(true);
                else if (timeLeft <= 0 || progress >= 100) finish(false, timeLeft <= 0 ? "ì‹œê°„ ì´ˆê³¼!" : "ê²Œì´ì§€ í­ì£¼!");
                updateBars();
            }, 1000);
        };

        function updateBars() {
            document.getElementById("heatFill").style.width = heat + "%";
            document.getElementById("progFill").style.width = Math.min(progress, 100) + "%";
        }

        function finish(success, reason = "") {
            clearInterval(timer); cooking = false;
            document.getElementById("cookUI").style.display = "none";
            document.getElementById("timerDisplay").innerText = "ì¤€ë¹„ ì¤‘...";
            if (success) {
                successSnd.play();
                const pools = [{name:"í™©ê¸ˆë¼ì§€",icon:"ğŸ·âœ¨"},{name:"ë‹¤ì´ì•„",icon:"ğŸ’"},{name:"ì™•ê´€",icon:"ğŸ‘‘"},{name:"ë§í† ",icon:"ğŸ§¥"}];
                const res = pools[Math.floor(Math.random()*pools.length)];
                inventory.push(res); equipped.push(res);
                alert(`ğŸŠ ì„±ê³µ! [${res.name}] íšë“!`);
            } else {
                failSnd.play(); alert(`ğŸ’¨ ì‹¤íŒ¨! ${reason}`);
            }
            cookItems = []; updateInv(); updateSlots(); updateAvatar(); saveData();
        }

        function updateAvatar() {
            const slots = document.getElementById("avatarSlots");
            slots.innerHTML = "";
            equipped.forEach(it => {
                const d = document.createElement("div");
                d.className = "invItem"; d.innerHTML = `<span>${it.icon}</span>`;
                slots.appendChild(d);
            });
        }

        // ì €ì¥ ë° ë¡œë“œ
        function saveData() { localStorage.setItem('magic_v9', JSON.stringify({inv:inventory, eq:equipped})); }
        function loadData() {
            const data = JSON.parse(localStorage.getItem('magic_v9'));
            if(data) { inventory = data.inv; equipped = data.eq; updateInv(); updateAvatar(); }
        }
        document.getElementById("resetData").onclick = () => { if(confirm("ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { localStorage.clear(); location.reload(); }};
        loadData();
    </script>
</body>
</html>