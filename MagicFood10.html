<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë§ˆë²• ìš”ë¦¬ì‚¬ - ìˆ˜ëŸ‰ í‘œì‹œ ì—ë””ì…˜</title>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì„¤ì • */
        body { margin: 0; background: #1c1c1c; color: #fff; font-family: 'Malgun Gothic', sans-serif; overflow: hidden; user-select: none; }
        #field { position: absolute; width: 100%; height: 100%; background: radial-gradient(circle, #2c2c2c, #111); }

        /* ìºë¦­í„° */
        #chef { position: absolute; bottom: 120px; left: 50%; transform: translateX(-50%); width: 80px; height: 140px; cursor: pointer; transition: 0.3s; z-index: 5; }
        #chef .head { width: 50px; height: 50px; border-radius: 50%; background: #ffd7a0; margin: auto; border: 2px solid #333; }
        #chef .body { width: 70px; height: 80px; background: #7a4; margin: auto; border-radius: 10px; border: 2px solid #333; position: relative; }
        #chef .body::after { content: "ğŸ‘¨â€ğŸ³"; position: absolute; top: 10px; left: 20px; font-size: 30px; }

        /* ì¸ë²¤í† ë¦¬ (3ì—´ & í° ì•„ì´ì½˜) */
        #inventory { 
            position: absolute; top: 10px; left: 10px; width: 320px; max-height: 80vh; 
            background: rgba(17, 17, 17, 0.95); border: 2px solid #555; padding: 10px; border-radius: 10px; overflow-y: auto; z-index: 10; 
        }
        #invList { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; }
        
        .invItem { 
            display: flex; flex-direction: column; align-items: center; background: #222; 
            border: 1px solid #444; border-radius: 8px; padding: 12px 5px; cursor: pointer; position: relative;
        }
        .invItem:hover { background: #333; border-color: #888; }
        
        /* ì•„ì´ì½˜ í¬ê¸° */
        .invItem span:first-child { font-size: 45px; margin-bottom: 5px; }
        /* ì•„ì´í…œ ì´ë¦„ */
        .invItem span:nth-child(2) { font-size: 13px; color: #ccc; }
        
        /* â˜… ìˆ˜ëŸ‰ í‘œì‹œ ë¼ë²¨ â˜… */
        .itemBadge {
            position: absolute; top: 5px; right: 5px; background: #ff5722; color: white;
            font-size: 12px; font-weight: bold; padding: 2px 6px; border-radius: 10px;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
        }

        /* ìš”ë¦¬ UI (5ê°œ ìŠ¬ë¡¯ ì§€ì›í•˜ë„ë¡ ë„ˆë¹„ í™•ì¥) */
        #cookUI { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            width: 550px; display: none; z-index: 100; background: rgba(17, 17, 17, 0.95); 
            border: 3px solid #777; padding: 20px; border-radius: 10px; 
        }
        #slots { display: flex; gap: 10px; margin: 15px 0; justify-content: center; }
        .slot { width: 75px; height: 75px; border: 2px dashed #aaa; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 45px; cursor: pointer; }

        /* ê²Œì´ì§€ ë°” ë° ë²„íŠ¼ ë“± ê¸°ì¡´ ìŠ¤íƒ€ì¼ ë™ì¼ */
        .bar { height: 28px; background: #222; position: relative; margin: 8px 0; border-radius: 14px; overflow: hidden; border: 2px solid #444; }
        .fill { height: 100%; width: 0%; background: linear-gradient(to right, #ffeb3b, #ff9800, #f44336); transition: 0.1s; }
        .zone { position: absolute; top: 0; height: 100%; background: rgba(255, 255, 0, 0.2); border-left: 2px solid yellow; border-right: 2px solid yellow; }
        .successZone { background: rgba(0, 255, 0, 0.2); border-left: 2px solid #0f0; border-right: 2px solid #0f0; }
        button { padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        #fire { background: #ff5722; color: white; }
        #water { background: #03a9f4; color: white; }
        #start { background: #4caf50; color: white; width: 100%; margin-top: 15px; font-size: 18px; }
        
        #avatarUI { position: absolute; top: 10px; right: 10px; width: 320px; background: rgba(17, 17, 17, 0.95); border: 2px solid #555; padding: 15px; border-radius: 10px; display: flex; flex-direction: column; align-items: center; }
        #avatarSlots { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 100%; margin-top: 10px;}
    </style>
</head>

<body>
    <div id="field"></div>
    <div id="chef"><div class="head"></div><div class="body"></div></div>

    <div id="inventory">
        <b>ğŸ’ ì¸ë²¤í† ë¦¬</b>
        <div id="invList"></div>
    </div>

    <div id="cookUI">
        <div style="display:flex; justify-content:space-between;"><b>ğŸ”® ë§ˆë²• ì—°ê¸ˆìˆ </b><span id="closeCook" style="cursor:pointer; color:red;">âœ–</span></div>
        <div id="timeText" style="text-align:center; font-size:20px; font-weight:bold; margin:10px;">ì¬ë£Œë¥¼ íˆ¬ì…í•˜ì„¸ìš”</div>
        <div style="text-align:center">ì¬ë£Œ: <span id="cnt">0</span> / 5</div>
        <div id="slots"></div>
        
        <div style="font-size:13px;">ğŸŒ¡ï¸ ì˜¨ë„ (ìë™ ìƒìŠ¹!)</div>
        <div class="bar"><div class="zone" style="left:35%;width:30%"></div><div class="fill" id="heatFill"></div></div>

        <div style="font-size:13px;">ğŸ§ª ì™„ì„±ë„ (60-75% ì‚¬ì´ì—ì„œ ë©ˆì¶”ê¸°)</div>
        <div class="bar"><div class="zone successZone" style="left:60%;width:15%"></div><div class="fill" id="progFill" style="background:#00e676;"></div></div>

        <div style="display:flex; gap:10px;">
            <button id="fire" style="flex:1">ğŸ”¥ í™”ì—¼ ë§ˆë²•</button>
            <button id="water" style="flex:1">â„ï¸ ëƒ‰ê¸° ë§ˆë²•</button>
        </div>
        <button id="start">âœ¨ 5ê°œ ì¬ë£Œë¡œ ìš”ë¦¬ ì‹œì‘</button>
    </div>

    <div id="avatarUI">
        <b>ğŸ‘— ì œì‘ì•„ì´í…œ</b>
        <div id="avatarSlots"></div>
        <button id="resetData" style="width:100%; margin-top:20px; background:#444; color:#ccc; font-size:11px;">ì „ì²´ ì´ˆê¸°í™”</button>
    </div>

    <script>
        // ì‚¬ìš´ë“œ ì„¤ì •
        const fireSnd = new Audio("https://www.soundjay.com/magic/sounds/magic-chime-01.mp3");
        const waterSnd = new Audio("https://www.soundjay.com/magic/sounds/magic-chime-03.mp3");
        const successSnd = new Audio("https://codeskulptor-demos.commondatastorage.googleapis.com/puffer_fish/bubble.mp3");
        const failSnd = new Audio("https://codeskulptor-demos.commondatastorage.googleapis.com/GalaxyInvaders/pause.wav");

        let inventory = [], cookItems = [], equipped = [];
        let cooking = false, heat = 0, progress = 0, timer = null;

        // --- â˜… í•µì‹¬: ì¸ë²¤í† ë¦¬ ê²¹ì¹˜ê¸° ë¡œì§ â˜… ---
        function updateInv() {
            const invList = document.getElementById("invList");
            invList.innerHTML = "";

            // 1. ìˆ˜ëŸ‰ ê³„ì‚° (ì´ë¦„ì„ í‚¤ë¡œ ì‚¬ìš©)
            const summary = {};
            inventory.forEach(item => {
                if(!summary[item.name]) {
                    summary[item.name] = { ...item, count: 0 };
                }
                summary[item.name].count++;
            });

            // 2. ê²¹ì³ì§„ ì•„ì´í…œ ë Œë”ë§
            Object.values(summary).forEach((item) => {
                const d = document.createElement("div");
                d.className = "invItem";
                d.innerHTML = `
                    <span>${item.icon}</span>
                    <span>${item.name}</span>
                    ${item.count > 1 ? `<div class="itemBadge">x${item.count}</div>` : ""}
                `;
                d.onclick = () => addSlot(item.name); // ì´ë¦„ìœ¼ë¡œ ì°¾ì•„ì„œ ì¶”ê°€í•˜ë„ë¡ ë³€ê²½
                invList.appendChild(d);
            });
        }

        // ì¸ë²¤í† ë¦¬ì—ì„œ ì¬ë£Œë¥¼ ì°¾ì•„ ìš”ë¦¬ ìŠ¬ë¡¯ìœ¼ë¡œ ì´ë™
        function addSlot(itemName) {
            if (cooking || cookItems.length >= 5) return;
            const idx = inventory.findIndex(it => it.name === itemName);
            if (idx > -1) {
                cookItems.push(inventory[idx]);
                inventory.splice(idx, 1);
                updateInv(); updateSlots();
            }
        }

        function updateSlots() {
            const slotsDiv = document.getElementById("slots");
            slotsDiv.innerHTML = "";
            for (let i = 0; i < 5; i++) {
                const s = document.createElement("div");
                s.className = "slot";
                if (cookItems[i]) s.innerText = cookItems[i].icon;
                s.onclick = () => {
                    if (cooking || !cookItems[i]) return;
                    inventory.push(cookItems[i]);
                    cookItems.splice(i, 1);
                    updateInv(); updateSlots();
                };
                slotsDiv.appendChild(s);
            }
            document.getElementById("cnt").innerText = cookItems.length;
        }

        // --- ë‚˜ë¨¸ì§€ ê²Œì„ ë¡œì§ ---
        function spawnItem() {
            if (cooking || document.querySelectorAll('.item').length > 8) return;
            const basic = [{ name: "ì•Œ", icon: "ğŸ¥š" }, { name: "ê°œêµ¬ë¦¬", icon: "ğŸ¸" }, { name: "ì•½ì´ˆ", icon: "ğŸŒ¿" }];
            const it = basic[Math.floor(Math.random() * basic.length)];
            const d = document.createElement("div");
            d.style.cssText = `position:absolute; cursor:pointer; font-size:32px; left:${Math.random()*90}%; top:${Math.random()*70}%;`;
            d.className = "item"; d.innerText = it.icon;
            d.onclick = () => { inventory.push(it); d.remove(); updateInv(); saveData(); };
            document.getElementById("field").appendChild(d);
        }
        setInterval(spawnItem, 2500);

        document.getElementById("chef").onclick = () => { if(!cooking) document.getElementById("cookUI").style.display = "block"; };
        document.getElementById("closeCook").onclick = () => {
            if(cooking) return;
            document.getElementById("cookUI").style.display = "none";
            cookItems.forEach(it => inventory.push(it));
            cookItems = []; updateInv(); updateSlots();
        };

        document.getElementById("fire").onclick = () => { if(cooking) { heat = Math.min(100, heat + 8); fireSnd.currentTime=0; fireSnd.play(); updateBars(); } };
        document.getElementById("water").onclick = () => { if(cooking) { heat = Math.max(0, heat - 10); waterSnd.currentTime=0; waterSnd.play(); updateBars(); } };

        document.getElementById("start").onclick = () => {
            if (cookItems.length < 5 || cooking) return;
            cooking = true; heat = 0; progress = 0;
            timer = setInterval(() => {
                heat = Math.min(100, heat + 2.5); // ìë™ ìƒìŠ¹
                if (heat >= 35 && heat <= 65) progress += 1.5;
                else progress = Math.max(0, progress - 1);
                
                if (progress >= 60 && progress <= 75) finish(true);
                else if (progress >= 100) finish(false);
                updateBars();
            }, 1000);
        };

        function updateBars() {
            document.getElementById("heatFill").style.width = heat + "%";
            document.getElementById("progFill").style.width = Math.min(progress, 100) + "%";
        }

        function finish(success) {
            clearInterval(timer); cooking = false;
            document.getElementById("cookUI").style.display = "none";
            if (success) {
                successSnd.play();
                const pools = [{name:"í™©ê¸ˆë¼ì§€",icon:"ğŸ·âœ¨"},{name:"ë‹¤ì´ì•„",icon:"ğŸ’"},{name:"ì™•ê´€",icon:"ğŸ‘‘"},{name:"ë§í† ",icon:"ğŸ§¥"}];
                const res = pools[Math.floor(Math.random()*pools.length)];
                inventory.push(res); equipped.push(res);
                alert(`ğŸŠ ì—°ì„± ì„±ê³µ! [${res.name}] íšë“!`);
            } else {
                failSnd.play();
                alert("ğŸ’¨ ê°€ë§ˆì†¥ì´ í­ì£¼í•˜ì—¬ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤!");
            }
            cookItems = []; updateInv(); updateSlots(); updateAvatar(); saveData();
        }

        function updateAvatar() {
            const slots = document.getElementById("avatarSlots");
            slots.innerHTML = "";
            equipped.forEach(it => {
                const d = document.createElement("div");
                d.className = "invItem"; d.innerHTML = `<span>${it.icon}</span>`;
                slots.appendChild(d);
            });
        }

        function saveData() { localStorage.setItem('magic_v4', JSON.stringify({inv:inventory, eq:equipped})); }
        function loadData() {
            const data = JSON.parse(localStorage.getItem('magic_v4'));
            if(data) { inventory = data.inv; equipped = data.eq; updateInv(); updateAvatar(); }
        }

        document.getElementById("resetData").onclick = () => { if(confirm("ì´ˆê¸°í™”?")) { localStorage.clear(); location.reload(); }};
        loadData();
    </script>
</body>
</html>