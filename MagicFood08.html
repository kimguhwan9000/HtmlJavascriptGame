<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë§ˆë²• ìš”ë¦¬ì‚¬ - ìµìŠ¤íŠ¸ë¦¼ ì—ë””ì…˜</title>
    <style>
        body { margin: 0; background: #1c1c1c; color: #fff; font-family: 'Malgun Gothic', sans-serif; overflow: hidden; }
        #field { position: absolute; width: 100%; height: 100%; background: radial-gradient(circle, #2c2c2c, #111); }

        .item {
            position: absolute; width: 48px; height: 48px;
            display: flex; align-items: center; justify-content: center;
            font-size: 32px; cursor: pointer; transition: transform 0.2s;
            filter: drop-shadow(0 0 5px rgba(255,255,255,0.3));
        }
        .item:hover { transform: scale(1.2); }

        #chef {
            position: absolute; bottom: 120px; left: 50%; transform: translateX(-50%);
            width: 80px; height: 140px; cursor: pointer; transition: 0.3s;
        }
        #chef:hover { filter: brightness(1.2); }
        #chef .head { width: 50px; height: 50px; border-radius: 50%; background: #ffd7a0; margin: auto; border: 2px solid #333; }
        #chef .body { width: 70px; height: 80px; background: #7a4; margin: auto; border-radius: 10px; border: 2px solid #333; position: relative; }
        #chef .body::after { content: "ğŸ‘¨â€ğŸ³"; position: absolute; top: 10px; left: 20px; font-size: 30px; }

        #inventory, #avatarUI, #cookUI {
            background: rgba(17, 17, 17, 0.95); border: 2px solid #555;
            padding: 15px; border-radius: 10px; box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }

        #inventory { position: absolute; top: 10px; left: 10px; width: 220px; max-height: 80vh; overflow-y: auto; }
        .invItem {
            display: inline-flex; flex-direction: column;
            align-items: center; width: 60px; margin: 5px; cursor: pointer;
            border: 1px solid #333; padding: 5px; border-radius: 5px; background: #222;
        }

        #cookUI {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 420px; display: none; z-index: 100; border: 3px solid #777;
        }
        #cookHeader { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #444; padding-bottom: 10px; }
        #closeCook { cursor: pointer; color: #ff4444; font-weight: bold; font-size: 20px; }

        #slots { display: flex; gap: 10px; margin: 15px 0; justify-content: center; }
        .slot {
            width: 70px; height: 70px; border: 2px dashed #aaa; border-radius: 10px;
            display: flex; align-items: center; justify-content: center; font-size: 40px; cursor: pointer;
        }

        .bar { height: 28px; background: #222; position: relative; margin: 8px 0; border-radius: 14px; overflow: hidden; border: 2px solid #444; }
        .fill { height: 100%; width: 0%; background: linear-gradient(to right, #ffeb3b, #ff9800, #f44336); transition: 0.1s; }
        .zone { position: absolute; top: 0; height: 100%; background: rgba(255, 255, 0, 0.2); border-left: 2px solid yellow; border-right: 2px solid yellow; }
        .successZone { background: rgba(0, 255, 0, 0.2); border-left: 2px solid #0f0; border-right: 2px solid #0f0; }

        #avatarUI { position: absolute; top: 10px; right: 10px; width: 220px; display: flex; flex-direction: column; align-items: center; }
        
        button { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        #fire { background: #ff5722; color: white; }
        #water { background: #03a9f4; color: white; }
        #start { background: #4caf50; color: white; width: 100%; margin-top: 10px; font-size: 16px; box-shadow: 0 4px #2e7d32; }
        #start:active { transform: translateY(2px); box-shadow: 0 2px #2e7d32; }
        #resetData { background: #444; color: #bbb; font-size: 10px; margin-top: 20px; border: 1px solid #555; }
        #timeText { margin: 10px 0; font-size: 20px; text-align: center; color: #ffeb3b; font-weight: bold; }
    </style>
</head>

<body>
    <div id="field"></div>

    <div id="chef">
        <div class="head"></div>
        <div class="body"></div>
    </div>

    <div id="inventory"><b>ğŸ’ ì¸ë²¤í† ë¦¬</b><br></div>

    <div id="cookUI">
        <div id="cookHeader">
            <b>ğŸ”® ë§ˆë²• ì—°ê¸ˆìˆ </b>
            <span id="closeCook">âœ–</span>
        </div>
        <div id="timeText">ìš”ë¦¬ ëŒ€ê¸° ì¤‘...</div>
        <div style="text-align:center; font-size: 14px; margin-bottom: 5px;">ì¬ë£Œ <span id="cnt">0</span> / 3</div>
        <div id="slots"></div>

        <div style="font-size: 13px; color: #ddd;">ğŸŒ¡ï¸ ì ì • ì˜¨ë„ ì¡°ì ˆ (35% ~ 65% ìœ ì§€!)</div>
        <div class="bar">
            <div class="zone" style="left:35%;width:30%"></div>
            <div class="fill" id="heatFill"></div>
        </div>

        <div style="font-size: 13px; color: #ddd;">ğŸ§ª ì™„ì„±ë„ (60% ~ 75% ì‚¬ì´ì—ì„œ ìš”ë¦¬ ì„±ê³µ!)</div>
        <div class="bar">
            <div class="zone successZone" style="left:60%;width:15%"></div>
            <div class="fill" id="progFill" style="background: #00e676; width: 0%;"></div>
        </div>

        <div style="display:flex; gap:10px;">
            <button id="fire" style="flex:1">ğŸ”¥ í™”ì—¼ ë§ˆë²• (+)</button>
            <button id="water" style="flex:1">â„ï¸ ëƒ‰ê¸° ë§ˆë²• (-)</button>
        </div>
        <button id="start">âœ¨ ë§ˆë²• ìš”ë¦¬ ì‹œì‘</button>
    </div>

    <div id="avatarUI">
        <b>ğŸ‘— ë“œë ˆìŠ¤ë£¸</b>
        <div id="avatarSlots"></div>
        <button id="resetData">ë°ì´í„° ì´ˆê¸°í™”</button>
    </div>

    <script>
        const items = [{ name: "ì•Œ", icon: "ğŸ¥š" }, { name: "ê°œêµ¬ë¦¬", icon: "ğŸ¸" }, { name: "ì•½ì´ˆ", icon: "ğŸŒ¿" }];
        const successItems = [
            { name: "ë¼ì§€ì½”", icon: "ğŸ½" }, { name: "í™©ê¸ˆë¼ì§€ì½”", icon: "ğŸ·âœ¨" }, { name: "ì •ì¥", icon: "ğŸ‘”" }, 
            { name: "ë“œë ˆìŠ¤", icon: "ğŸ‘—" }, { name: "í•´ì í‹°", icon: "â˜ ï¸ğŸ‘•" }, { name: "ë¬´ì°¬ì´ ë°˜ì§€", icon: "ğŸ’" }, 
            { name: "ì•„ì´í°25", icon: "ğŸ“±" }, { name: "ê°¤ëŸ­ì‹œí°", icon: "ğŸ“±" }, { name: "ì‚°íƒ€ë³µ", icon: "ğŸ…" }
        ];

        // --- ì‚¬ìš´ë“œ êµì²´ (ë” í€„ë¦¬í‹° ë†’ì€ ë§ˆë²• ì‚¬ìš´ë“œ) ---
        const fireSnd = new Audio("https://codeskulptor-demos.commondatastorage.googleapis.com/despot/collapse.mp3"); // ê°•ë ¥í•œ í­ë°œìŒ
        const waterSnd = new Audio("https://codeskulptor-demos.commondatastorage.googleapis.com/despot/recharge.mp3"); // ë§ˆë²•ì  ëƒ‰ê¸° ì¶©ì „ìŒ
        const successSnd = new Audio("https://codeskulptor-demos.commondatastorage.googleapis.com/puffer_fish/bubble.mp3"); // ë§‘ì€ ì„±ê³µìŒ
        const failSnd = new Audio("https://codeskulptor-demos.commondatastorage.googleapis.com/GalaxyInvaders/pause.wav"); // ì‹¤íŒ¨ìŒ

        fireSnd.volume = 0.4;
        waterSnd.volume = 0.4;

        let inventory = [], cookItems = [], equipped = [];
        let cooking = false, heat = 0, progress = 0, timer = null, timeLeft = 120;

        const field = document.getElementById("field");
        const inv = document.getElementById("inventory");
        const cookUI = document.getElementById("cookUI");
        const slotsDiv = document.getElementById("slots");
        const heatFill = document.getElementById("heatFill");
        const progFill = document.getElementById("progFill");
        const chef = document.getElementById("chef");
        const timeText = document.getElementById("timeText");
        const avatarSlots = document.getElementById("avatarSlots");

        function saveData() {
            localStorage.setItem('magic_save_inv', JSON.stringify(inventory));
            localStorage.setItem('magic_save_eq', JSON.stringify(equipped));
        }

        function loadData() {
            const si = localStorage.getItem('magic_save_inv');
            const se = localStorage.getItem('magic_save_eq');
            if (si) inventory = JSON.parse(si);
            if (se) equipped = JSON.parse(se);
            updateInv(); updateAvatar();
        }

        function spawnItem() {
            if (cooking || document.querySelectorAll('.item').length > 8) return;
            const it = items[Math.floor(Math.random() * items.length)];
            const d = document.createElement("div");
            d.className = "item"; d.innerText = it.icon;
            d.style.left = Math.random() * 90 + "%"; d.style.top = Math.random() * 70 + "%";
            d.onclick = () => { inventory.push(it); d.remove(); updateInv(); saveData(); };
            field.appendChild(d);
        }
        setInterval(spawnItem, 2500);

        function updateInv() {
            inv.innerHTML = "<b>ğŸ’ ì¸ë²¤í† ë¦¬</b><br>";
            inventory.forEach((it, i) => {
                const d = document.createElement("div");
                d.className = "invItem";
                d.innerHTML = `${it.icon}<br><small>${it.name}</small>`;
                d.onclick = () => addSlot(i);
                inv.appendChild(d);
            });
        }

        function updateSlots() {
            slotsDiv.innerHTML = "";
            for (let i = 0; i < 3; i++) {
                const s = document.createElement("div");
                s.className = "slot";
                if (cookItems[i]) s.innerText = cookItems[i].icon;
                s.onclick = () => {
                    if (cooking || !cookItems[i]) return;
                    inventory.push(cookItems[i]); cookItems.splice(i, 1);
                    updateInv(); updateSlots(); saveData();
                };
                slotsDiv.appendChild(s);
            }
            document.getElementById("cnt").innerText = cookItems.length;
        }

        function addSlot(i) {
            if (cooking || cookItems.length >= 3) return;
            cookItems.push(inventory[i]); inventory.splice(i, 1);
            updateInv(); updateSlots(); saveData();
        }

        function updateAvatar() {
            avatarSlots.innerHTML = "";
            equipped.forEach(it => {
                const d = document.createElement("div");
                d.className = "invItem";
                d.innerHTML = `${it.icon}<br><small>${it.name}</small>`;
                avatarSlots.appendChild(d);
            });
        }

        chef.onclick = () => { if (!cooking) cookUI.style.display = "block"; };
        document.getElementById("closeCook").onclick = () => {
            if (cooking) return;
            cookUI.style.display = "none";
            cookItems.forEach(it => inventory.push(it));
            cookItems = []; updateInv(); updateSlots();
        };

        // --- í™”ë ¥/ëƒ‰ê° ì¡°ì ˆ ---
        document.getElementById("fire").onclick = () => {
            if (!cooking) return;
            fireSnd.currentTime = 0; fireSnd.play();
            heat = Math.min(100, heat + 8);
            updateBars();
        };

        document.getElementById("water").onclick = () => {
            if (!cooking) return;
            waterSnd.currentTime = 0; waterSnd.play();
            heat = Math.max(0, heat - 8);
            updateBars();
        };

        // --- ìš”ë¦¬ ì‹œì‘ ë¡œì§ ---
        document.getElementById("start").onclick = () => {
            if (cookItems.length < 3 || cooking) return;
            cooking = true;
            timeLeft = 120; 
            progress = 0; 
            heat = 0; // [ìˆ˜ì •] ì˜¨ë„ë¥¼ 0ë¶€í„° ì‹œì‘í•˜ê²Œ ë³€ê²½
            updateBars();

            timer = setInterval(() => {
                timeLeft--;
                timeText.innerText = `ë‚¨ì€ ì‹œê°„: ${timeLeft}ì´ˆ`;

                // ì˜¨ë„ íŒì •: ì ì • ë²”ìœ„ ìœ ì§€ ì‹œ ì§„í–‰ë„ ìƒìŠ¹
                if (heat >= 35 && heat <= 65) {
                    progress += 2;
                } else {
                    progress = Math.max(0, progress - 1);
                }

                // ì„±ê³µ êµ¬ì—­ (60%~75%) ë„ë‹¬ ì‹œ ìë™ ì™„ì„±
                if (progress >= 60 && progress <= 75) {
                    finish(true);
                }

                // ê³¼ë¶€í•˜(100%) ë˜ëŠ” ì‹œê°„ ì´ˆê³¼ ì‹œ ì‹¤íŒ¨
                if (timeLeft <= 0 || progress >= 100) {
                    finish(false);
                }
                updateBars();
            }, 1000);
        };

        function updateBars() {
            heatFill.style.width = heat + "%";
            progFill.style.width = Math.min(progress, 100) + "%";
        }

        function finish(success) {
            clearInterval(timer);
            timer = null; cooking = false;
            cookUI.style.display = "none";

            if (success) {
                successSnd.play();
                const newItem = successItems[Math.floor(Math.random() * successItems.length)];
                inventory.push(newItem); equipped.push(newItem);
                updateInv(); updateAvatar(); saveData();
                alert(`ğŸŠ ì—°ê¸ˆìˆ  ëŒ€ì„±ê³µ! [${newItem.name}]ì„(ë¥¼) ì—°ì„±í–ˆìŠµë‹ˆë‹¤!`);
            } else {
                failSnd.play();
                alert("ğŸ’¨ í‘! ì—°ê¸ˆìˆ ì— ì‹¤íŒ¨í•˜ì—¬ ì¬ë£Œê°€ ì¦ë°œí–ˆìŠµë‹ˆë‹¤.");
            }
            cookItems = []; updateSlots(); saveData();
            timeText.innerText = "ìš”ë¦¬ ëŒ€ê¸° ì¤‘...";
        }

        document.getElementById('resetData').onclick = () => {
            if (confirm("ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí• ê¹Œìš”?")) { localStorage.clear(); location.reload(); }
        };

        loadData();
    </script>
</body>
</html>