<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë§ˆë²• ìš”ë¦¬ì‚¬ - í­ì£¼í•˜ëŠ” ê°€ë§ˆì†¥</title>
    <style>
        /* [ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ ë° ìµœì í™”] */
        body { margin: 0; background: #1c1c1c; color: #fff; font-family: 'Malgun Gothic', sans-serif; overflow: hidden; user-select: none; }
        #field { position: absolute; width: 100%; height: 100%; background: radial-gradient(circle, #2c2c2c, #111); }

        .item { position: absolute; width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; font-size: 32px; cursor: pointer; transition: transform 0.2s; filter: drop-shadow(0 0 5px rgba(255,255,255,0.3)); }
        #chef { position: absolute; bottom: 120px; left: 50%; transform: translateX(-50%); width: 80px; height: 140px; cursor: pointer; transition: 0.3s; }
        #chef .head { width: 50px; height: 50px; border-radius: 50%; background: #ffd7a0; margin: auto; border: 2px solid #333; }
        #chef .body { width: 70px; height: 80px; background: #7a4; margin: auto; border-radius: 10px; border: 2px solid #333; position: relative; }
        #chef .body::after { content: "ğŸ‘¨â€ğŸ³"; position: absolute; top: 10px; left: 20px; font-size: 30px; }

        #inventory { position: absolute; top: 10px; left: 10px; width: 300px; max-height: 80vh; background: rgba(17, 17, 17, 0.95); border: 2px solid #555; padding: 10px; border-radius: 10px; overflow-y: auto; z-index: 10; }
        #invList { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-top: 10px; }
        .invItem { display: flex; flex-direction: column; align-items: center; background: #222; border: 1px solid #333; border-radius: 5px; padding: 10px; cursor: pointer; font-size: 25px; }

        #cookUI { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 420px; display: none; z-index: 100; background: rgba(17, 17, 17, 0.95); border: 3px solid #777; padding: 15px; border-radius: 10px; }
        #cookHeader { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #444; padding-bottom: 10px; }
        #closeCook { cursor: pointer; color: #ff4444; font-weight: bold; font-size: 20px; }

        #slots { display: flex; gap: 10px; margin: 15px 0; justify-content: center; }
        .slot { width: 70px; height: 70px; border: 2px dashed #aaa; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 40px; cursor: pointer; }

        .bar { height: 28px; background: #222; position: relative; margin: 8px 0; border-radius: 14px; overflow: hidden; border: 2px solid #444; }
        .fill { height: 100%; width: 0%; background: linear-gradient(to right, #ffeb3b, #ff9800, #f44336); transition: 0.1s; }
        .zone { position: absolute; top: 0; height: 100%; background: rgba(255, 255, 0, 0.2); border-left: 2px solid yellow; border-right: 2px solid yellow; }
        .successZone { background: rgba(0, 255, 0, 0.2); border-left: 2px solid #0f0; border-right: 2px solid #0f0; }

        #avatarUI { position: absolute; top: 10px; right: 10px; width: 300px; background: rgba(17, 17, 17, 0.95); border: 2px solid #555; padding: 15px; border-radius: 10px; display: flex; flex-direction: column; align-items: center; }
        #avatarSlots { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; width: 100%; margin-top: 10px;}
        
        button { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        #fire { background: #ff5722; color: white; }
        #water { background: #03a9f4; color: white; }
        #start { background: #4caf50; color: white; width: 100%; margin-top: 10px; font-size: 16px; }
        #timeText { margin: 10px 0; font-size: 20px; text-align: center; color: #ffeb3b; font-weight: bold; }
        .warning { color: #ff4444; font-size: 12px; text-align: center; margin-top: 5px; font-weight: bold; }
    </style>
</head>

<body>
    <div id="field"></div>
    <div id="chef"><div class="head"></div><div class="body"></div></div>

    <div id="inventory">
        <b>ğŸ’ ì¸ë²¤í† ë¦¬</b>
        <div id="invList"></div>
    </div>

    <div id="cookUI">
        <div id="cookHeader"><b>ğŸ”® ë§ˆë²•ìš”ë¦¬</b><span id="closeCook">âœ–</span></div>
        <div id="timeText">ìš”ë¦¬ ëŒ€ê¸° ì¤‘...</div>
        <div id="slots"></div>
        
        <div style="font-size: 13px; color: #ddd;">ğŸŒ¡ï¸ ì˜¨ë„ (ë°©ì¹˜ ì‹œ ìë™ìœ¼ë¡œ ìƒìŠ¹í•©ë‹ˆë‹¤!)</div>
        <div class="bar">
            <div class="zone" style="left:35%;width:30%"></div>
            <div class="fill" id="heatFill"></div>
        </div>

        <div style="font-size: 13px; color: #ddd;">ğŸ§ª ì™„ì„±ë„ (60% ~ 75% ì‚¬ì´ì—ì„œ ë©ˆì¶”ì„¸ìš”)</div>
        <div class="bar">
            <div class="zone successZone" style="left:60%;width:15%"></div>
            <div class="fill" id="progFill" style="background: #00e676; width: 0%;"></div>
        </div>

        <div style="display:flex; gap:10px;">
            <button id="fire" style="flex:1">ğŸ”¥ í™”ì—¼ ì£¼ì… (+)</button>
            <button id="water" style="flex:1">â„ï¸ ëƒ‰ê¸° ì£¼ì… (-)</button>
        </div>
        <button id="start">âœ¨ ìš”ë¦¬ ì‹œì‘</button>
        <div class="warning">âš ï¸ ì£¼ì˜: ê°€ë§ˆì†¥ì´ ìŠ¤ìŠ¤ë¡œ ëœ¨ê±°ì›Œì§‘ë‹ˆë‹¤!</div>
    </div>

    <div id="avatarUI">
        <b>ğŸ‘— ì œì‘í…œ</b>
        <div id="avatarSlots"></div>
        <button id="resetData" style="background:#444; color:#bbb; font-size:10px; margin-top:10px;">ë°ì´í„° ì´ˆê¸°í™”</button>
    </div>

    <script>
        // --- ì‚¬ìš´ë“œ ì„¤ì • (HTML5 Audio ì•ˆì •ì„± ê°•í™”) ---
        const fireSnd = new Audio("https://www.soundjay.com/magic/sounds/magic-chime-01.mp3");
        const waterSnd = new Audio("https://www.soundjay.com/magic/sounds/magic-chime-03.mp3");
        const successSnd = new Audio("https://codeskulptor-demos.commondatastorage.googleapis.com/puffer_fish/bubble.mp3");
        const failSnd = new Audio("https://codeskulptor-demos.commondatastorage.googleapis.com/GalaxyInvaders/pause.wav");

        let inventory = [], cookItems = [], equipped = [];
        let cooking = false, heat = 0, progress = 0, timer = null, timeLeft = 120;

        const invList = document.getElementById("invList");
        const cookUI = document.getElementById("cookUI");
        const slotsDiv = document.getElementById("slots");
        const heatFill = document.getElementById("heatFill");
        const progFill = document.getElementById("progFill");
        const chef = document.getElementById("chef");
        const timeText = document.getElementById("timeText");
        const avatarSlots = document.getElementById("avatarSlots");

        function saveData() {
            localStorage.setItem('magic_save_inv_v3', JSON.stringify(inventory));
            localStorage.setItem('magic_save_eq_v3', JSON.stringify(equipped));
        }

        function loadData() {
            const si = localStorage.getItem('magic_save_inv_v3');
            const se = localStorage.getItem('magic_save_eq_v3');
            if (si) inventory = JSON.parse(si);
            if (se) equipped = JSON.parse(se);
            updateInv(); updateAvatar();
        }

        function spawnItem() {
            if (cooking || document.querySelectorAll('.item').length > 8) return;
            const items = [{ name: "ì•Œ", icon: "ğŸ¥š" }, { name: "ê°œêµ¬ë¦¬", icon: "ğŸ¸" }, { name: "ì•½ì´ˆ", icon: "ğŸŒ¿" }];
            const it = items[Math.floor(Math.random() * items.length)];
            const d = document.createElement("div");
            d.className = "item"; d.innerText = it.icon;
            d.style.left = Math.random() * 90 + "%"; d.style.top = Math.random() * 70 + "%";
            d.onclick = () => { inventory.push(it); d.remove(); updateInv(); saveData(); };
            document.getElementById("field").appendChild(d);
        }
        setInterval(spawnItem, 2500);

        function updateInv() {
            invList.innerHTML = "";
            inventory.forEach((it, i) => {
                const d = document.createElement("div");
                d.className = "invItem";
                d.innerHTML = `<span>${it.icon}</span><span style="font-size:9px">${it.name}</span>`;
                d.onclick = () => addSlot(i);
                invList.appendChild(d);
            });
        }

        function updateSlots() {
            slotsDiv.innerHTML = "";
            for (let i = 0; i < 5; i++) {
                const s = document.createElement("div");
                s.className = "slot";
                if (cookItems[i]) s.innerText = cookItems[i].icon;
                s.onclick = () => {
                    if (cooking || !cookItems[i]) return;
                    inventory.push(cookItems[i]); cookItems.splice(i, 1);
                    updateInv(); updateSlots();
                };
                slotsDiv.appendChild(s);
            }
        }

        function addSlot(i) {
            if (cooking || cookItems.length >= 5) return;
            cookItems.push(inventory[i]); inventory.splice(i, 1);
            updateInv(); updateSlots();
        }

        function updateAvatar() {
            avatarSlots.innerHTML = "";
            equipped.forEach(it => {
                const d = document.createElement("div");
                d.className = "invItem";
                d.innerHTML = `<span>${it.icon}</span>`;
                avatarSlots.appendChild(d);
            });
        }

        chef.onclick = () => { if (!cooking) cookUI.style.display = "block"; };
        document.getElementById("closeCook").onclick = () => {
            if (cooking) return;
            cookUI.style.display = "none";
            cookItems.forEach(it => inventory.push(it));
            cookItems = []; updateInv(); updateSlots();
        };

        function playSnd(audio) {
            audio.currentTime = 0;
            audio.play().catch(() => {});
        }

        document.getElementById("fire").onclick = () => {
            if (!cooking) return;
            playSnd(fireSnd);
            heat = Math.min(100, heat + 8);
            updateBars();
        };

        document.getElementById("water").onclick = () => {
            if (!cooking) return;
            playSnd(waterSnd);
            heat = Math.max(0, heat - 10); // ì‹íˆëŠ” ê²Œ ë” ì¤‘ìš”í•˜ë¯€ë¡œ ìˆ˜ì¹˜ ìƒí–¥
            updateBars();
        };

        document.getElementById("start").onclick = () => {
            if (cookItems.length < 3 || cooking) return;
            cooking = true;
            timeLeft = 120; progress = 0; heat = 0;
            updateBars();

            timer = setInterval(() => {
                timeLeft--;
                
                // [í•µì‹¬] ê°€ë§Œíˆ ìˆì–´ë„ í™”ì—¼ ë§ˆë²•ì´ ì•„ì£¼ ì¡°ê¸ˆì”© ìƒìŠ¹ (ì´ˆë‹¹ +2)
                heat = Math.min(100, heat + 2.5);

                timeText.innerText = `ë‚¨ì€ ì‹œê°„: ${timeLeft}ì´ˆ`;
                
                // ì˜¨ë„ íŒì • (35~65 ì‚¬ì´ ìœ ì§€)
                if (heat >= 35 && heat <= 65) { 
                    progress += 1.5; 
                } else { 
                    progress = Math.max(0, progress - 1); 
                }

                if (progress >= 60 && progress <= 75) { finish(true); }
                if (timeLeft <= 0 || progress >= 100) { finish(false); }
                
                updateBars();
            }, 1000);
        };

        function updateBars() {
            heatFill.style.width = heat + "%";
            progFill.style.width = Math.min(progress, 100) + "%";
        }

        function finish(success) {
            clearInterval(timer);
            timer = null; cooking = false;
            cookUI.style.display = "none";

            if (success) {
                playSnd(successSnd);
                const successItems = [{ name: "í™©ê¸ˆë¼ì§€", icon: "ğŸ·âœ¨" }, { name: "ë°˜ì§€", icon: "ğŸ’" }, { name: "ì•„ì´í°", icon: "ğŸ“±" }, { name: "ë“œë ˆìŠ¤", icon: "ğŸ‘—" }];
                const newItem = successItems[Math.floor(Math.random() * successItems.length)];
                inventory.push(newItem); equipped.push(newItem);
                updateInv(); updateAvatar(); saveData();
                alert(`ğŸŠ ì„±ê³µ! [${newItem.name}] ì—°ì„±!`);
            } else {
                playSnd(failSnd);
                alert("ğŸ’¨ ì‹¤íŒ¨! ê°€ë§ˆì†¥ì´ í­ë°œí•˜ê±°ë‚˜ ì‹œê°„ì´ ë‹¤ ëìŠµë‹ˆë‹¤.");
            }
            cookItems = []; updateSlots();
        }

        document.getElementById('resetData').onclick = () => {
            if (confirm("ì´ˆê¸°í™”í• ê¹Œìš”?")) { localStorage.clear(); location.reload(); }
        };

        loadData();
    </script>
</body>
</html>